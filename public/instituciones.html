<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Instituciones</title>

  <!-- 💡 Librerías externas -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />

  <!-- 🎨 Estilos internos -->
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="css/filtros.css">
  <link rel="stylesheet" href="css/estilosTarjetas.css">
</head>

<body>
  <h1 class="titulo-seccion">📋 Instituciones Registradas</h1>

  <div class="botones-navegacion">
    <button onclick="window.history.back()">⬅️ Volver</button>
    <button onclick="window.location.href='/'">🏠 Inicio</button>
    <button onclick="abrirFormulario()" class="boton-principal">➕ Registrar nueva institución</button>

    <div class="filtros-avanzados">
      <select id="filtroTurno">
        <option value="">Todos los turnos</option>
        <option value="Mañana">Mañana</option>
        <option value="Tarde">Tarde</option>
        <option value="Mañana Tarde">Mañana Tarde</option>
      </select>

      <select id="filtroDependencia">
        <option value="">Todas las dependencias</option>
        <option value="Nacional">Nacional</option>
        <option value="Estadal">Estadal</option>
        <option value="Municipal">Municipal</option>
        <option value="Privada">Privada</option>
      </select>

      <select id="filtroNivel">
        <option value="">Todos los Niveles</option>
        <option value="Maternal">Maternal</option>
        <option value="Inicial">Inicial</option>
        <option value="Maternal Inicial">Maternal Inicial</option>
        <option value="Primaria">Primaria</option>
        <option value="Inicial Primaria">Inicial Primaria</option>
        <option value="Media General">Media General</option>
        <option value="Inicial Primaria Media General">Inicial Primaria Media General</option>
        <option value="Especial">Especial</option>
        <option value="Adultos">Adultos</option>
      </select>

      <select id="filtroCircuito">
        <option value="">Todos los circuitos</option>
      </select>
    </div>
  </div>

  <!-- 💡 Lote 2 -->

  <!-- ⏳ Spinner de carga -->
  <div id="cargandoTabla" class="spinner-container">
    <div class="spinner"></div>
    <p>Estamos Procesando la Información, ¡Gracias por su espera! 🌀</p>
  </div>

  <!-- 📊 Tabla de instituciones -->
  <table id="tablaInstituciones" class="display" style="width:100%">
    <thead></thead>
  </table>

  <!-- 📈 Tarjetas resumen -->
  <div class="resumen-container">
    <div class="card tarjeta-institucional">
      <div class="icon">🏫</div>
      <strong id="totalInstituciones" class="resumen-numero">—</strong>
      <span>Instituciones</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">🏛️</div>
      <strong id="totalDependencias" class="resumen-numero">—</strong>
      <span>Dependencias</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">📚</div>
      <strong id="totalNiveles" class="resumen-numero">—</strong>
      <span>Niveles</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">👤</div>
      <strong id="totalDirectores" class="resumen-numero">—</strong>
      <span>Directores únicos</span>
    </div>

    <p id="mensajeResumen" class="mensaje-resumen"></p>
  </div>

  <!-- 📋 Formulario Modal de Institución -->
  <div id="modalRegistro" style="display:none;">
    <form id="formInstitucion">

      <label for="codigodea">Código DEA:</label>
      <input type="text" id="codigodea" name="codigodea" required />
      <span id="mensajeDEA" class="mensaje-validacion"></span>

      <label for="nombreplantel">Nombre del Plantel:</label>
      <input type="text" id="nombreplantel" name="nombreplantel" required />
      <span id="mensajeNombre" class="mensaje-validacion"></span>

      <!-- 🔍 Sugerencia de directores -->
      <label for="ceduladirector">Cédula del Director:</label>
      <input type="text" id="ceduladirector" list="listaDirectores" oninput="sugerirDirector()"
        onblur="buscarDirector()" required />
      <datalist id="listaDirectores"></datalist>
      <span id="mensajeDirector" class="mensaje-validacion"></span>

      <!-- 📇 Datos referenciales del director -->
      <fieldset class="fieldset-lectura">
        <legend>Datos del Director</legend>
        <input type="text" id="nombredirector" class="lectura" placeholder="Nombre completo" readonly />
        <input type="text" id="telefonodirector" class="lectura" placeholder="Teléfono" readonly />
        <input type="email" id="correodirector" class="lectura" placeholder="Correo electrónico" readonly />
        <p class="mensaje-informativo">📌 Estos datos se extraen automáticamente del módulo “Personal”.</p>
      </fieldset>

      <!-- 💡 Lote 3 -->

      <label for="codigodep">Código de dependencia:</label>
      <input type="text" id="codigodep" name="codigodep" required />
      <span id="mensajeCodDependencia" class="mensaje-validacion"></span>

      <label for="dependencia">Dependencia:</label>
      <select id="dependencia" name="dependencia">
        <option value="">Seleccionar</option>
        <option value="Nacional">Nacional</option>
        <option value="Estadal">Estadal</option>
        <option value="Municipal">Municipal</option>
        <option value="Privada">Privada</option>
      </select>
      <span id="mensajeDependencia" class="mensaje-validacion"></span>

      <label for="niveledu">Nivel Educativo:</label>
      <select id="niveledu" name="niveledu">
        <option value="">Seleccionar</option>
        <option value="Maternal">Maternal</option>
        <option value="Inicial">Inicial</option>
        <option value="Primaria">Primaria</option>
        <option value="Media General">Media General</option>
        <option value="Especial">Especial</option>
        <option value="Adultos">Adultos</option>
      </select>
      <span id="mensajeNivel" class="mensaje-validacion"></span>

      <label for="turno">Turno:</label>
      <select id="turno" name="turno">
        <option value="">Seleccionar</option>
        <option value="Mañana">Mañana</option>
        <option value="Tarde">Tarde</option>
        <option value="Mañana Tarde">Mañana Tarde</option>
      </select>
      <span id="mensajeturno" class="mensaje-validacion"></span>

      <label for="parroquia">Parroquia:</label>
      <select id="parroquia" name="parroquia">
        <option value="">Seleccionar</option>
        <option value="Lobatera">Lobatera</option>
        <option value="Otra">Otra</option>
      </select>
      <span id="mensajeParroquia" class="mensaje-validacion"></span>

      <label for="codcircuitoedu">Circuito Educativo:</label>
      <select id="codcircuitoedu" name="codcircuitoedu"></select>
      <span id="mensajeCircuito" class="mensaje-validacion"></span>
      <div id="detalleCircuito" class="detalle-texto"></div>
      <div id="detalleSupervisor" class="detalle-texto"></div>

      <label for="codestadistico">Código estadístico:</label>
      <input type="text" id="codestadistico" name="codestadistico" />

      <label for="codcenvot">Código CENVOT:</label>
      <input type="text" id="codcenvot" name="codcenvot" />

      <label for="nombrecenvot">Nombre CENVOT:</label>
      <input type="text" id="nombrecenvot" name="nombrecenvot" />

      <label for="eponimoanterior">Epónimo anterior:</label>
      <input type="text" id="eponimoanterior" name="eponimoanterior" />

      <!-- 🏷️ Status institucional -->
      <label for="status">Status:</label>
      <select id="status" name="status">
        <option value="Activo">Activo</option>
        <option value="Inactivo">Inactivo</option>
      </select>
      <span id="mensajeStatus" class="mensaje-validacion"></span>

      <!-- 🧷 Campos ocultos -->
      <input type="hidden" name="registrado" value="">
      <input type="hidden" id="modoFormulario" value="crear" />
      <input type="hidden" id="idInstitucionEditar" />

      <!-- 🟢 Botones de acción -->
      <button type="submit">Guardar Institución</button>
      <button type="button" onclick="cerrarFormulario()" style="margin-left:1rem;">Cancelar</button>
      <button type="button" id="btnEliminarInstitucion" class="peligro" style="display: none;">
        Eliminar institución 🗑️
      </button>
    </form>
  </div>

  <!-- 💡 Lote 4 -->

  <!-- 📚 Librerías externas necesarias -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- 🔐 Inicialización del cliente Supabase (frontend) -->
  <script>
    window.supabase = supabase.createClient(
      'https://ymtagfdcrejmuyqflvif.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltdGFnZmRjcmVqbXV5cWZsdmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNzI3NTUsImV4cCI6MjA2NTg0ODc1NX0._5V445n-Bpy7_Ahvxwc3CM9f3aRLzBVtiGoMjce-N2I'
    );
  </script>

  <!-- 🧠 Scripts internos y módulos CDCE -->
  <script src="js/utils.js"></script>
  <script src="js/tablasCDCE.js" type="module"></script>
  <script src="js/instituciones.js" type="module"></script>
</body>

</html>