<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GestiÃ³n de Instituciones</title>

  <!-- ğŸ’¡ LibrerÃ­as externas -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />

  <!-- ğŸ¨ Estilos internos -->
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="css/filtros.css">
  <link rel="stylesheet" href="css/estilosTarjetas.css">
</head>

<body>
  <h1 class="titulo-seccion">ğŸ“‹ Instituciones Registradas</h1>

  <div class="botones-navegacion">
    <button onclick="window.history.back()">â¬…ï¸ Volver</button>
    <button onclick="window.location.href='/'">ğŸ  Inicio</button>
    <button onclick="abrirFormulario()" class="boton-principal">â• Registrar nueva instituciÃ³n</button>

    <div class="filtros-avanzados">
      <select id="filtroTurno">
        <option value="">Todos los turnos</option>
        <option value="MaÃ±ana">MaÃ±ana</option>
        <option value="Tarde">Tarde</option>
        <option value="MaÃ±ana Tarde">MaÃ±ana Tarde</option>
      </select>

      <select id="filtroDependencia">
        <option value="">Todas las dependencias</option>
        <option value="Nacional">Nacional</option>
        <option value="Estadal">Estadal</option>
        <option value="Municipal">Municipal</option>
        <option value="Privada">Privada</option>
      </select>

      <select id="filtroNivel">
        <option value="">Todos los Niveles</option>
        <option value="Maternal">Maternal</option>
        <option value="Inicial">Inicial</option>
        <option value="Maternal Inicial">Maternal Inicial</option>
        <option value="Primaria">Primaria</option>
        <option value="Inicial Primaria">Inicial Primaria</option>
        <option value="Media General">Media General</option>
        <option value="Inicial Primaria Media General">Inicial Primaria Media General</option>
        <option value="Especial">Especial</option>
        <option value="Adultos">Adultos</option>
      </select>

      <select id="filtroCircuito">
        <option value="">Todos los circuitos</option>
      </select>
    </div>
  </div>

  <!-- Lote 2 -->

  <!-- â³ Spinner de carga -->
  <div id="cargandoTabla" class="spinner-container">
    <div class="spinner"></div>
    <p>Estamos Procesando la InformaciÃ³n, Â¡Gracias por su espera! ğŸŒ€</p>
  </div>

  <!-- ğŸ“Š Tabla de instituciones -->
  <table id="tablaInstituciones" class="display" style="width:100%">
    <thead></thead>
  </table>

  <!-- ğŸ“ˆ Tarjetas resumen -->
  <div class="resumen-container">
    <div class="card tarjeta-institucional">
      <div class="icon">ğŸ«</div>
      <strong id="totalInstituciones" class="resumen-numero">â€”</strong>
      <span>Instituciones</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">ğŸ›ï¸</div>
      <strong id="totalDependencias" class="resumen-numero">â€”</strong>
      <span>Dependencias</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">ğŸ“š</div>
      <strong id="totalNiveles" class="resumen-numero">â€”</strong>
      <span>Niveles</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">ğŸ‘¤</div>
      <strong id="totalDirectores" class="resumen-numero">â€”</strong>
      <span>Directores Ãºnicos</span>
    </div>

    <p id="mensajeResumen" class="mensaje-resumen"></p>
  </div>

  <!-- Lote 3 -->

  <!-- ğŸ” Buscador independiente de director -->
  <fieldset style="margin-top:1rem;">
    <legend><i class="fa fa-search" aria-hidden="true"></i> Buscar director por nombre o cÃ©dula parcial</legend>
    <input type="text" id="busquedaDirector" placeholder="Ej. Oxiel, V81..." autocomplete="off"
      oninput="window.buscarDirectoresSugeridos(this.value)" />
    <ul id="listaSugerenciasDirector" class="lista-sugerencias"></ul>
  </fieldset>

  <!-- ğŸ§¾ Campo directo para ingresar cÃ©dula -->
  <fieldset>
    <legend>Datos del Director</legend>
    <label for="ceduladirector">CÃ©dula del Director *:</label><br>
    <input type="text" id="ceduladirector" name="ceduladirector" autocomplete="off" required
      oninput="if (this.value.length >= 3) sugerirDirector();" onblur="buscarDirector()" /><br>
    <datalist id="listaDirectores"></datalist><br>
    <span id="mensajeDirector" class="info-director"></span>
  </fieldset>

  <!-- ğŸ“‹ Datos referenciales del director -->
  <fieldset disabled class="fieldset-lectura">
    <legend><i class="fa fa-user" aria-hidden="true"></i> Datos del Director (referencia)</legend>
    <label for="nombredirector">Nombre:</label>
    <input id="nombredirector" type="text" readonly>
    <label for="telefonodirector">TelÃ©fono:</label>
    <input id="telefonodirector" type="text" readonly>
    <label for="correodirector">Correo:</label>
    <input id="correodirector" type="email" readonly>
    <p class="mensaje-informativo">
      ğŸ“Œ Estos datos provienen del registro del personal y se actualizan desde la secciÃ³n <strong>â€œPersonalâ€</strong>.
    </p>
  </fieldset>

  <!-- ğŸ·ï¸ Status institucional -->
  <label>Status *:</label><br>
  <select name="status" id="status">
    <option value="Activo">Activo</option>
    <option value="Inactivo">Inactivo</option>
  </select><br><br>
  <span id="mensajeStatus" class="mensaje-validacion"></span>

  <!-- ğŸ§· Campos ocultos -->
  <input type="hidden" name="registrado" value="">
  <input type="hidden" id="modoFormulario" value="crear" />
  <input type="hidden" id="idInstitucionEditar" />

  <!-- ğŸŸ¢ Botones de acciÃ³n -->
  <button type="submit">Guardar InstituciÃ³n</button>
  <button type="button" onclick="cerrarFormulario()" style="margin-left:1rem;">Cancelar</button>
  <button type="button" id="btnEliminarInstitucion" class="peligro" style="display: none;">
    Eliminar instituciÃ³n ğŸ—‘ï¸
  </button>
  </form>
  </div>

  <!-- Lote 4 -->

  <!-- ğŸ“š LibrerÃ­as externas necesarias -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- ğŸ” InicializaciÃ³n del cliente Supabase (frontend) -->
  <script>
    window.supabase = supabase.createClient(
      'https://ymtagfdcrejmuyqflvif.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltdGFnZmRjcmVqbXV5cWZsdmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNzI3NTUsImV4cCI6MjA2NTg0ODc1NX0._5V445n-Bpy7_Ahvxwc3CM9f3aRLzBVtiGoMjce-N2I'
    );
  </script>

  <!-- ğŸ§  Scripts internos y mÃ³dulos CDCE -->
  <script src="js/utils.js"></script>
  <script src="js/tablasCDCE.js" type="module"></script>
  <script src="js/instituciones.js" type="module"></script>
</body>

</html>