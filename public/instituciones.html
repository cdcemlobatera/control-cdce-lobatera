<!-- Lote 1 -->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gesti√≥n de Instituciones</title>

  <!-- üí° Librer√≠as externas -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />

  <!-- üé® Estilos internos -->
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="css/filtros.css">
  <link rel="stylesheet" href="css/estilosTarjetas.css">
</head>

<body>
  <h1 class="titulo-seccion">üìã Instituciones Registradas</h1>

  <div class="botones-navegacion">
    <button onclick="window.history.back()">‚¨ÖÔ∏è Volver</button>
    <button onclick="window.location.href='/'">üè† Inicio</button>
    <button onclick="abrirFormulario()" class="boton-principal">‚ûï Registrar nueva instituci√≥n</button>

    <div class="filtros-avanzados">
      <select id="filtroTurno">
        <option value="">Todos los turnos</option>
        <option value="Ma√±ana">Ma√±ana</option>
        <option value="Tarde">Tarde</option>
        <option value="Ma√±ana Tarde">Ma√±ana Tarde</option>
      </select>

      <select id="filtroDependencia">
        <option value="">Todas las dependencias</option>
        <option value="Nacional">Nacional</option>
        <option value="Estadal">Estadal</option>
        <option value="Municipal">Municipal</option>
        <option value="Privada">Privada</option>
      </select>

      <select id="filtroNivel">
        <option value="">Todos los Niveles</option>
        <option value="Maternal">Maternal</option>
        <option value="Inicial">Inicial</option>
        <option value="Maternal Inicial">Maternal Inicial</option>
        <option value="Primaria">Primaria</option>
        <option value="Inicial Primaria">Inicial Primaria</option>
        <option value="Media General">Media General</option>
        <option value="Inicial Primaria Media General">Inicial Primaria Media General</option>
        <option value="Especial">Especial</option>
        <option value="Adultos">Adultos</option>
      </select>

      <select id="filtroCircuito">
        <option value="">Todos los circuitos</option>
      </select>
    </div>
  </div>

  <!-- ‚è≥ Spinner de carga -->
  <div id="cargandoTabla" class="spinner-container">
    <div class="spinner"></div>
    <p>Estamos Procesando la Informaci√≥n, ¬°Gracias por su espera! üåÄ</p>
  </div>

  <!-- üìä Tabla -->
  <table id="tablaInstituciones" class="display" style="width:100%">
    <thead></thead>
  </table>

  <!-- üìà Tarjetas resumen -->
  <div class="resumen-container">
    <div class="card tarjeta-institucional">
      <div class="icon">üè´</div>
      <strong id="totalInstituciones" class="resumen-numero">‚Äî</strong>
      <span>Instituciones</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">üèõÔ∏è</div>
      <strong id="totalDependencias" class="resumen-numero">‚Äî</strong>
      <span>Dependencias</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">üìö</div>
      <strong id="totalNiveles" class="resumen-numero">‚Äî</strong>
      <span>Niveles</span>
    </div>

    <div class="card tarjeta-institucional">
      <div class="icon">üë§</div>
      <strong id="totalDirectores" class="resumen-numero">‚Äî</strong>
      <span>Directores √∫nicos</span>
    </div>

    <p id="mensajeResumen" class="mensaje-resumen"></p>
  </div>

  <!-- Lote 2 -->

  <!-- üì¶ Modal del formulario -->
  <div id="modalRegistro" style="display: none; position: fixed; top: 5%; left: 50%; transform: translateX(-50%);
background: #fff; padding: 1.5rem; box-shadow: 0 0 10px #aaa; max-width: 600px; width: 90%; z-index: 999;
max-height: 90vh; overflow-y: auto;">

    <h2 id="tituloFormulario">Datos de la Instituci√≥n</h2>
    <form id="formInstitucion">
      <fieldset style="margin-bottom:1rem;">
        <legend>Datos del Plantel</legend>

        <label>C√≥digo DEA:</label>
        <input type="text" name="codigodea" id="codigodea" onblur="validarDEA()" placeholder="Requerido">
        <span id="mensajeDEA" class="mensaje-validacion"></span>

        <label>Nombre del Plantel:</label>
        <input type="text" id="nombreplantel" name="nombreplantel" placeholder="Requerido">
        <span id="mensajeNombre" class="mensaje-validacion"></span>

        <!-- üîç Sugerencia de director -->
        <label>C√©dula del Director *:</label>
        <input type="text" id="ceduladirector" name="ceduladirector" oninput="sugerirDirector()"
          onblur="buscarDirector()" list="listaDirectores" autocomplete="off" placeholder="Ej. V12345678">
        <datalist id="listaDirectores"></datalist>
        <span id="mensajeDirector" class="mensaje-validacion"></span>

        <!-- üìã Datos referenciales del director -->
        <fieldset disabled class="fieldset-lectura">
          <legend>
            <i class="fa fa-user" aria-hidden="true"></i> Datos del Director <small>(referencia)</small>
          </legend>

          <label for="nombredirector">Nombre:</label>
          <input id="nombredirector" type="text" class="lectura" readonly>

          <label for="telefonodirector">Tel√©fono:</label>
          <input id="telefonodirector" type="text" class="lectura" readonly>

          <label for="correodirector">Correo:</label>
          <input id="correodirector" type="email" class="lectura" readonly>

          <p class="mensaje-informativo">
            üìå Estos datos provienen del registro del personal y se actualizan desde la secci√≥n
            <strong>‚ÄúPersonal‚Äù</strong>.
          </p>
        </fieldset>

        <label>Eponimo Anterior:</label>
        <input type="text" id="eponimoanterior" name="eponimoanterior" placeholder="No Aplica">

        <label>C√≥digo de Dependencia:</label>
        <input type="text" name="codigodep" id="codigodep" placeholder="Requerido">
        <span id="mensajeCodDependencia" class="mensaje-validacion"></span>

        <label>Dependencia *:</label>
        <select name="dependencia" id="dependencia">
          <option value="">Seleccione</option>
          <option value="Nacional">Nacional</option>
          <option value="Estadal">Estadal</option>
          <option value="Municipal">Municipal</option>
          <option value="Privada">Privada</option>
        </select>
        <span id="mensajeDependencia" class="mensaje-validacion"></span>

        <label>Nivel Educativo *:</label>
        <select name="niveledu" id="niveledu">
          <option value="">Seleccione</option>
          <option value="Maternal">Maternal</option>
          <option value="Inicial">Inicial</option>
          <option value="Maternal Inicial">Maternal Inicial</option>
          <option value="Primaria">Primaria</option>
          <option value="Inicial Primaria">Inicial Primaria</option>
          <option value="Media General">Media General</option>
          <option value="Inicial Primaria Media General">Inicial Primaria Media General</option>
          <option value="Especial">Especial</option>
          <option value="Adultos">Adultos</option>
        </select>
        <span id="mensajeNivel" class="mensaje-validacion"></span>

        <label for="turno">Turno Laborable *:</label>
        <select id="turno" name="turno">
          <option value="">Seleccione</option>
          <option value="Ma√±ana">Ma√±ana</option>
          <option value="Tarde">Tarde</option>
          <option value="Ma√±ana Tarde">Ma√±ana Tarde</option>
        </select>
        <span id="mensajeturno" class="mensaje-validacion"></span>

        <label>Parroquia *:</label>
        <select name="parroquia" id="parroquia">
          <option value="">Seleccione</option>
          <option value="LOBATERA">LOBATERA</option>
          <option value="CONSTITUCION">CONSTITUCI√ìN</option>
        </select>
        <span id="mensajeParroquia" class="mensaje-validacion"></span>

        <label for="codcircuitoedu">Circuito Educativo: *</label>
        <select id="codcircuitoedu" name="codcircuitoedu">
          <option value="">Seleccione un circuito</option>
        </select>
        <span id="mensajeCircuito" class="mensaje-validacion"></span>

        <p id="detalleCircuito" class="detalle-texto"></p>
        <div class="detalle-info">
          <p id="detalleSupervisor"></p>
        </div>

        <label for="codestadistico">C√≥digo Estad√≠stico</label>
        <input type="text" id="codestadistico" name="codestadistico" placeholder="De poseer c√≥digo estad√≠stico">

        <label for="codcenvot">C√≥digo Centro de Votaci√≥n</label>
        <input type="text" id="codcenvot" name="codcenvot" placeholder="Ingrese si el plantel es Centro Electoral">

        <label for="nombrecenvot">Nombre Centro de Votaci√≥n</label>
        <input type="text" id="nombrecenvot" name="nombrecenvot" placeholder="Nombre ante el (CNE)">

        <!-- Lote 3 -->

        <!-- üè∑Ô∏è Status institucional -->
        <label>Status *:</label>
        <select name="status" id="status">
          <option value="Activo">Activo</option>
          <option value="Inactivo">Inactivo</option>
        </select>
        <span id="mensajeStatus" class="mensaje-validacion"></span>

        <!-- üß∑ Campos ocultos -->
        <input type="hidden" name="registrado" value="">
        <input type="hidden" id="modoFormulario" value="crear" />
        <input type="hidden" id="idInstitucionEditar" />

        <!-- üü¢ Botones de acci√≥n -->
        <button type="submit">Guardar Instituci√≥n</button>
        <button type="button" onclick="cerrarFormulario()" style="margin-left:1rem;">Cancelar</button>
        <button type="button" id="btnEliminarInstitucion" class="peligro" style="display: none;">
          Eliminar instituci√≥n üóëÔ∏è
        </button>
    </form>
  </div>

  <!-- üìö Librer√≠as externas necesarias -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- üîê Inicializaci√≥n del cliente Supabase -->
  <script>
    window.supabase = supabase.createClient(
      'https://ymtagfdcrejmuyqflvif.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltdGFnZmRjcmVqbXV5cWZsdmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNzI3NTUsImV4cCI6MjA2NTg0ODc1NX0._5V445n-Bpy7_Ahvxwc3CM9f3aRLzBVtiGoMjce-N2I'
    );
  </script>

  <!-- üß† Scripts internos y m√≥dulos CDCE -->
  <script src="js/utils.js"></script>
  <script type="module" src="js/tablasCDCE.js"></script>
  <script type="module" src="js/instituciones.js"></script>
</body>

</html>